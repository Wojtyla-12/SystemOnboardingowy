@model SystemOnboardingowy.Models.Wdrozenie
@{
    ViewData["Title"] = "Szczegóły";
}

<div class="row">
    <div class="col-md-7">
        <div class="card bg-dark text-white mb-4 border-secondary">
            <div class="card-body">
                <h3>@Model.Pracownik?.Imie @Model.Pracownik?.Nazwisko</h3>
                <p>Start pracy: @Model.DataRozpoczeciaPracy.ToShortDateString()</p>
                @if (User.IsInRole("Kierownik") && Model.Status != SystemOnboardingowy.Models.StatusZgloszenia.Anulowane && Model.Status != SystemOnboardingowy.Models.StatusZgloszenia.Zakonczone)
                {
                    <form asp-action="Anuluj" class="d-inline"><input type="hidden" name="id" value="@Model.Id" /><button class="btn btn-danger btn-sm" onclick="return confirm('Anulować?')">🚫 Anuluj</button></form>
                }
            </div>
        </div>
        <h4>Zadania</h4>
        <div class="list-group">
            @foreach (var zad in Model.Zadania)
            {
                bool czyMoge = (User.IsInRole("Kierownik") || User.IsInRole(zad.Dzial.ToString()));
                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center @(zad.CzyWykonane ? "bg-dark text-secondary" : "bg-dark text-white") border-secondary">
                    <div><span class="badge bg-secondary me-2">@zad.Dzial</span> @if(zad.CzyWykonane){
                    <s>@zad.Tresc</s>
                }else
                {

                    <span>@zad.Tresc</span>
                }
</div>
                <div>
                    @if (czyMoge && Model.Status != SystemOnboardingowy.Models.StatusZgloszenia.Anulowane)
                    {
                        <form asp-action="WykonajZadanie" method="post"><input type="hidden" name="zadanieId" value="@zad.Id" /><button class="btn btn-sm @(zad.CzyWykonane ? "btn-outline-success" : "btn-outline-light")">@(zad.CzyWykonane ? "✅ Cofnij" : "⬜ Wykonaj")</button></form>
                    }
                    else if (zad.CzyWykonane)
                    {

                        <span>✅</span>
                    }
                </div>
            </div>
                        }
        </div>
    </div>
    <div class="col-md-5">
        <div class="card bg-secondary text-white" style="height: 600px;">
            <div class="card-header bg-dark border-bottom">Historia</div>
            <div class="card-body overflow-auto" style="background-color: #2b2b2b;">
                @foreach (var n in Model.Notatki)
                {
                    <div class="mb-3 p-2 rounded" style="background-color: @(n.CzyAutomatyczna ? "#3a3a3a" : "#454545"); border-left: 4px solid @(n.CzyAutomatyczna ? "#6c757d" : "#0d6efd");">
                        <div class="d-flex justify-content-between small text-muted"><strong>@n.Autor</strong><span>@n.DataUtworzenia.ToString("dd.MM HH:mm")</span></div>
                        <div class="mt-1">@n.Tresc</div>
                    </div>
                }
            </div>
            <div class="card-footer bg-dark">
                <form asp-action="DodajNotatke" method="post"><input type="hidden" name="id" value="@Model.Id" /><div class="input-group"><input name="tresc" class="form-control bg-dark text-white" required placeholder="Komentarz..." /><button class="btn btn-primary">Wyślij</button></div></form>
            </div>
        </div>
    </div>
</div>
<div class="mt-3"><a asp-action="Index" class="btn btn-secondary">Wróć</a></div>